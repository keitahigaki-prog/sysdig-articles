# ãªãœã‚³ãƒ³ãƒ†ãƒŠã¯"ä¿¡ç”¨ã§ããªã„"ã®ã‹
## â€• Kubernetesã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æŠ€è¡“çš„æ·±å±¤ â€•

## ã¯ã˜ã‚ã«

ã€Œã‚³ãƒ³ãƒ†ãƒŠã¯éš”é›¢ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰å®‰å…¨ã€

ã“ã®èªè­˜ã¯ã€**åŠåˆ†æ­£ã—ãã€åŠåˆ†é–“é•ã£ã¦ã„ã¾ã™ã€‚**

ã‚³ãƒ³ãƒ†ãƒŠã¯ç¢ºã‹ã«éš”é›¢ã•ã‚Œã¦ã„ã¾ã™ãŒã€ãã®éš”é›¢ã¯**å®Œå…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚
VMã®ã‚ˆã†ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ¬ãƒ™ãƒ«ã®éš”é›¢ã§ã¯ãªãã€**Linuxã‚«ãƒ¼ãƒãƒ«ã®æ©Ÿèƒ½ã«ã‚ˆã‚‹è«–ç†çš„ãªéš”é›¢**ã§ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€ä»¥ä¸‹ã‚’æŠ€è¡“çš„ã«æ·±æ˜ã‚Šã—ã¾ã™ï¼š

- **ã‚³ãƒ³ãƒ†ãƒŠã®æ­£ä½“** â€• ãƒ—ãƒ­ã‚»ã‚¹ã¨ã‚«ãƒ¼ãƒãƒ«ã®é–¢ä¿‚
- **Namespace / Cgroup** â€• éš”é›¢ã®ä»•çµ„ã¿ã¨é™ç•Œ
- **Seccomp / AppArmor / SELinux** â€• ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«åˆ¶é™
- **eBPF** â€• ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç›£è¦–ã®é©å‘½
- **ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã§ã®é˜²å¾¡** â€• å¤šå±¤é˜²å¾¡æˆ¦ç•¥

å‰æè¨˜äº‹ï¼š[Kubernetesã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æœ¬è³ª â€• ãªãœãƒ©ãƒ³ã‚¿ã‚¤ãƒ é˜²å¾¡ãŒå¿…è¦ãªã®ã‹](https://qiita.com/keitah/items/c25440de24eea858a24b)

---

## ã‚³ãƒ³ãƒ†ãƒŠã®æ­£ä½“ â€• ãã‚Œã¯ã€Œç‰¹æ®Šãªãƒ—ãƒ­ã‚»ã‚¹ã€

### ã‚³ãƒ³ãƒ†ãƒŠ â‰  ä»®æƒ³ãƒã‚·ãƒ³

å¤šãã®äººãŒèª¤è§£ã—ã¦ã„ã‚‹ã“ã¨ï¼š

| èª¤è§£ | ç¾å®Ÿ |
|-----|------|
| ã‚³ãƒ³ãƒ†ãƒŠã¯è»½é‡VM | ã‚³ãƒ³ãƒ†ãƒŠã¯**ãŸã ã®ãƒ—ãƒ­ã‚»ã‚¹** |
| ã‚³ãƒ³ãƒ†ãƒŠã¯ç‹¬ç«‹ã—ãŸOS | ãƒ›ã‚¹ãƒˆOSã®ã‚«ãƒ¼ãƒãƒ«ã‚’**å…±æœ‰** |
| ã‚³ãƒ³ãƒ†ãƒŠã¯å®Œå…¨ã«éš”é›¢ | ã‚«ãƒ¼ãƒãƒ«ã‚’é€šã˜ã¦**ã¤ãªãŒã£ã¦ã„ã‚‹** |

### ã‚³ãƒ³ãƒ†ãƒŠã®æœ¬è³ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Host OS Kernel          â”‚  â† 1ã¤ã®ã‚«ãƒ¼ãƒãƒ«ã‚’å…±æœ‰
â”‚      (Linux 5.x / 6.x)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘        â†‘        â†‘
     â”‚        â”‚        â”‚
 â”Œâ”€â”€â”€â”´â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â” â”Œâ”€â”€â”´â”€â”€â”€â”
 â”‚ Pod Aâ”‚ â”‚ Pod Bâ”‚ â”‚ Pod Câ”‚
 â”‚(PID 1)â”‚(PID 2)â”‚(PID 3)â”‚
 â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ‘‰ **ã‚³ãƒ³ãƒ†ãƒŠã¯ã€Œã‚«ãƒ¼ãƒãƒ«ã«ã‚ˆã£ã¦éš”é›¢ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã€ã«éããªã„**

### ã“ã‚ŒãŒæ„å‘³ã™ã‚‹ã“ã¨

- ã‚«ãƒ¼ãƒãƒ«ã«è„†å¼±æ€§ãŒã‚ã‚Œã°ã€**å…¨ã‚³ãƒ³ãƒ†ãƒŠãŒå½±éŸ¿ã‚’å—ã‘ã‚‹**
- ã‚«ãƒ¼ãƒãƒ«ã®æŒ™å‹•ã‚’æ‚ªç”¨ã™ã‚Œã°ã€**ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠã«å¹²æ¸‰ã§ãã‚‹å¯èƒ½æ€§**
- ç‰¹æ¨©æ“ä½œã‚’è¨±å¯ã™ã‚Œã°ã€**ãƒ›ã‚¹ãƒˆã‚’ä¹—ã£å–ã‚Œã‚‹**

---

## Linux Namespaceã«ã‚ˆã‚‹éš”é›¢ â€• ã¨ãã®é™ç•Œ

### Namespaceã¨ã¯ï¼Ÿ

Linuxã‚«ãƒ¼ãƒãƒ«ãŒæä¾›ã™ã‚‹**ãƒªã‚½ãƒ¼ã‚¹ã®è«–ç†çš„ãªåˆ†é›¢æ©Ÿæ§‹**ã§ã™ã€‚

### 7ã¤ã®Namespace

| Namespace | éš”é›¢å¯¾è±¡ | ä¾‹ |
|-----------|---------|---|
| **PID** | ãƒ—ãƒ­ã‚»ã‚¹ID | ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯ PID 1 ã«è¦‹ãˆã‚‹ |
| **NET** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | ç‹¬ç«‹ã—ãŸIPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒãƒ¼ãƒˆ |
| **MNT** | ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ  | ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒˆFS |
| **UTS** | ãƒ›ã‚¹ãƒˆå | ç‹¬è‡ªã®ãƒ›ã‚¹ãƒˆå |
| **IPC** | ãƒ—ãƒ­ã‚»ã‚¹é–“é€šä¿¡ | å…±æœ‰ãƒ¡ãƒ¢ãƒªãƒ»ã‚»ãƒãƒ•ã‚© |
| **USER** | UID/GID | ãƒ«ãƒ¼ãƒˆæ¨©é™ã®ãƒãƒƒãƒ”ãƒ³ã‚° |
| **Cgroup** | ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ | CPU/ãƒ¡ãƒ¢ãƒªã®åˆ†é›¢ |

### å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•

```bash
# DockerãŒå†…éƒ¨ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã“ã¨ï¼ˆç°¡ç•¥ç‰ˆï¼‰
unshare --pid --net --mount --uts --ipc --fork \
  chroot /var/lib/docker/overlay2/.../merged \
  /bin/sh
```

ğŸ‘‰ **`unshare` = Namespaceã‚’åˆ†é›¢ã™ã‚‹**

---

### Namespaceã®é™ç•Œ

#### 1ï¸âƒ£ ã‚«ãƒ¼ãƒãƒ«ã¯å…±æœ‰ã•ã‚Œã¦ã„ã‚‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kernel (å…±æœ‰)            â”‚
â”‚  - /proc/sys/*            â”‚  â† å…¨ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰è¦‹ãˆã‚‹
â”‚  - /sys/*                 â”‚  â† å¤‰æ›´å¯èƒ½
â”‚  - ã‚«ãƒ¼ãƒãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«      â”‚  â† ãƒ­ãƒ¼ãƒ‰å¯èƒ½
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å±é™ºãªä¾‹**ï¼š

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ï¼ˆç‰¹æ¨©ãŒã‚ã‚Œã°ï¼‰
echo 1 > /proc/sys/kernel/sysrq
# ãƒ›ã‚¹ãƒˆå…¨ä½“ã«å½±éŸ¿
```

#### 2ï¸âƒ£ Namespace Escapeæ”»æ’ƒ

ç‰¹å®šã®æ¡ä»¶ä¸‹ã§ã€Namespaceã‚’ã€Œè„±å‡ºã€ã§ãã‚‹è„†å¼±æ€§ãŒå®šæœŸçš„ã«ç™ºè¦‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

**æœ‰åãªäº‹ä¾‹**ï¼š
- **CVE-2019-5736** (runc vulnerability)
  - ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ `runc` ãƒã‚¤ãƒŠãƒªã‚’ä¸Šæ›¸ã
  - ãƒ›ã‚¹ãƒˆã®rootæ¨©é™ã‚’å¥ªå–

- **CVE-2022-0847** (Dirty Pipe)
  - ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãå¯èƒ½
  - ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ›ã‚¹ãƒˆã¸ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—

#### 3ï¸âƒ£ /proc, /sys ã®éœ²å‡º

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰
cat /proc/1/environ     # ãƒ›ã‚¹ãƒˆã®PID 1ã®ç’°å¢ƒå¤‰æ•°ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå«ã‚€å¯èƒ½æ€§ï¼‰
cat /sys/class/net/eth0/address  # ãƒ›ã‚¹ãƒˆã®MAC addressãªã©
```

ğŸ‘‰ **Namespaceã¯ã€Œè¦‹ãŸç›®ä¸Šã®éš”é›¢ã€ã§ã‚ã‚Šã€çµ¶å¯¾çš„ãªé˜²å¾¡ã§ã¯ãªã„**

---

## Cgroupã«ã‚ˆã‚‹ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ â€• DoSæ”»æ’ƒã®é˜²æ­¢

### Cgroupã¨ã¯ï¼Ÿ

**Control Groups** = ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ã‚’åˆ¶é™ã™ã‚‹ä»•çµ„ã¿

### åˆ¶é™ã§ãã‚‹ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹ | åˆ¶é™å†…å®¹ | Kubernetes ã§ã®è¨­å®š |
|---------|---------|-------------------|
| **CPU** | CPUæ™‚é–“ã®å‰²ã‚Šå½“ã¦ | `resources.limits.cpu` |
| **Memory** | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | `resources.limits.memory` |
| **Disk I/O** | ãƒ‡ã‚£ã‚¹ã‚¯ã‚¢ã‚¯ã‚»ã‚¹é€Ÿåº¦ | `--device-write-bps` |
| **Network** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¸¯åŸŸ | CNIãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä¾å­˜ |

### ãªãœCgroupãŒé‡è¦ã‹ï¼Ÿ

#### âŒ CgroupãŒç„¡ã„å ´åˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Host (8 cores, 16GB)    â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Pod A â”‚  â”‚Pod B â”‚  â”‚Pod C â”‚â”‚
â”‚  â”‚ 90%  â”‚  â”‚ 5%   â”‚  â”‚ 5%   â”‚â”‚  â† Pod AãŒæš´èµ°
â”‚  â”‚ CPU  â”‚  â”‚ CPU  â”‚  â”‚ CPU  â”‚â”‚     ä»–ã®PodãŒåœæ­¢
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ğŸ‘‰ **1ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠãŒãƒ›ã‚¹ãƒˆå…¨ä½“ã‚’å æœ‰ã§ãã‚‹ = Noisy Neighborå•é¡Œ**

#### âœ… Cgroupã«ã‚ˆã‚‹åˆ¶é™

```yaml
resources:
  limits:
    cpu: "500m"      # æœ€å¤§0.5ã‚³ã‚¢
    memory: "512Mi"  # æœ€å¤§512MB
  requests:
    cpu: "250m"
    memory: "256Mi"
```

### Cgroupã®é™ç•Œ

#### 1ï¸âƒ£ å®Œå…¨ãªéš”é›¢ã§ã¯ãªã„

Cgroupã¯**ä½¿ç”¨é‡ã®åˆ¶é™**ã§ã‚ã‚Šã€**ã‚¢ã‚¯ã‚»ã‚¹ã®åˆ¶é™**ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰
cat /sys/fs/cgroup/memory/memory.limit_in_bytes  # åˆ¶é™å€¤ã¯è¦‹ãˆã‚‹
# åˆ¶é™ã‚’è¶…ãˆã‚ˆã†ã¨ã™ã‚‹ã¨ OOM Killer ãŒç™ºå‹•
```

#### 2ï¸âƒ£ Fork Bomb ã¸ã®è„†å¼±æ€§

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§
:(){ :|:& };:
```

ğŸ‘‰ **PIDåˆ¶é™ï¼ˆ`pids.max`ï¼‰ãŒç„¡ã‘ã‚Œã°ã€ãƒ›ã‚¹ãƒˆã®ãƒ—ãƒ­ã‚»ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åŸ‹ã‚å°½ãã›ã‚‹**

Kuberneteså¯¾ç­–ï¼š

```yaml
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: app
    resources:
      limits:
        # PIDæ•°ã‚‚åˆ¶é™å¯èƒ½ï¼ˆKubernetes 1.20+ï¼‰
        pids: "100"
```

---

## Seccomp / AppArmor / SELinux â€• ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«åˆ¶é™

ã“ã“ã‹ã‚‰ãŒ**æœ¬å½“ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é˜²å¾¡**ã§ã™ã€‚

### 3ã¤ã®é˜²å¾¡æŠ€è¡“

| æŠ€è¡“ | å½¹å‰² | ç²’åº¦ |
|-----|------|------|
| **Seccomp** | ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«åˆ¶é™ | ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«å˜ä½ |
| **AppArmor** | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | ãƒ‘ã‚¹å˜ä½ |
| **SELinux** | å¼·åˆ¶ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆMACï¼‰ | ãƒ©ãƒ™ãƒ«å˜ä½ |

---

### Seccompï¼ˆSecure Computing Modeï¼‰

#### ãªãœå¿…è¦ã‹ï¼Ÿ

Linuxã‚«ãƒ¼ãƒãƒ«ã«ã¯**ç´„300ä»¥ä¸Šã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«**ãŒã‚ã‚Šã¾ã™ã€‚
ã‚³ãƒ³ãƒ†ãƒŠãŒ**ã™ã¹ã¦**ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ä½¿ãˆã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```
é€šå¸¸ã®ã‚¢ãƒ—ãƒª: read, write, open, close, fork, execve ãªã© 20-30å€‹

å±é™ºãªã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«:
  - reboot       (ãƒ›ã‚¹ãƒˆã‚’å†èµ·å‹•)
  - mount        (ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ)
  - ptrace       (ä»–ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ‡ãƒãƒƒã‚°)
  - bpf          (eBPFãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ­ãƒ¼ãƒ‰)
  - keyctl       (ã‚«ãƒ¼ãƒãƒ«ã‚­ãƒ¼ãƒªãƒ³ã‚°æ“ä½œ)
```

#### Seccompãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

```json
{
  "defaultAction": "SCMP_ACT_ERRNO",
  "architectures": ["SCMP_ARCH_X86_64"],
  "syscalls": [
    {
      "names": ["read", "write", "open", "close"],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "names": ["reboot", "mount", "umount"],
      "action": "SCMP_ACT_KILL"
    }
  ]
}
```

#### Kubernetes ã§ã®é©ç”¨

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secure-app
spec:
  securityContext:
    seccompProfile:
      type: RuntimeDefault  # Dockerã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
      # ã¾ãŸã¯
      # type: Localhost
      # localhostProfile: profiles/custom.json
  containers:
  - name: app
    image: myapp:latest
```

#### Dockerã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

Dockerã¯[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§44å€‹ã®ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’ãƒ–ãƒ­ãƒƒã‚¯](https://github.com/moby/moby/blob/master/profiles/seccomp/default.json)ã—ã¦ã„ã¾ã™ã€‚

ä¸»ãªãƒ–ãƒ­ãƒƒã‚¯å¯¾è±¡ï¼š
- `reboot`
- `swapon` / `swapoff`
- `mount` / `umount`
- `init_module` / `finit_module`
- `kexec_load`

ğŸ‘‰ **SeccompãŒç„¡ã‘ã‚Œã°ã€ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãƒ›ã‚¹ãƒˆã‚’å†èµ·å‹•ã§ãã‚‹**

---

### AppArmorï¼ˆApplication Armorï¼‰

#### å½¹å‰²

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ‘ã‚¹å˜ä½ã§åˆ¶é™**

#### ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

```bash
# /etc/apparmor.d/docker-default

profile docker-default flags=(attach_disconnected,mediate_deleted) {
  # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
  deny /proc/sys/** w,           # /proc/sys ã¸ã®æ›¸ãè¾¼ã¿ç¦æ­¢
  deny /sys/** w,                # /sys ã¸ã®æ›¸ãè¾¼ã¿ç¦æ­¢

  # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™
  network inet tcp,
  network inet udp,
  deny network raw,              # Raw socketã¯ç¦æ­¢

  # Mountåˆ¶é™
  deny mount,
  deny umount,
}
```

#### Kubernetes ã§ã®é©ç”¨

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: apparmor-pod
  annotations:
    container.apparmor.security.beta.kubernetes.io/app: localhost/docker-default
spec:
  containers:
  - name: app
    image: nginx
```

---

### SELinuxï¼ˆSecurity-Enhanced Linuxï¼‰

#### å½¹å‰²

**å¼·åˆ¶ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆMAC: Mandatory Access Controlï¼‰**

ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒãƒ¼ãƒˆã«**ãƒ©ãƒ™ãƒ«**ã‚’ä»˜ä¸ã—ã€
ãƒ©ãƒ™ãƒ«é–“ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒãƒªã‚·ãƒ¼ã§åˆ¶å¾¡ã€‚

#### SELinuxãƒ©ãƒ™ãƒ«ã®ä¾‹

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ—ãƒ­ã‚»ã‚¹
ps -eZ | grep container
system_u:system_r:container_t:s0:c123,c456 12345 ?   00:00:01 nginx

# ãƒ•ã‚¡ã‚¤ãƒ«
ls -Z /var/lib/docker/volumes/
system_u:object_r:container_file_t:s0:c123,c456 data
```

#### Kubernetes ã§ã®é©ç”¨

```yaml
apiVersion: v1
kind: Pod
spec:
  securityContext:
    seLinuxOptions:
      level: "s0:c123,c456"  # MCS (Multi-Category Security)
  containers:
  - name: app
    image: myapp
```

---

### 3ã¤ã®æŠ€è¡“ã®ä½¿ã„åˆ†ã‘

| çŠ¶æ³ | æ¨å¥¨æŠ€è¡“ |
|------|---------|
| **ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’åˆ¶é™ã—ãŸã„** | Seccomp |
| **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™** | AppArmorï¼ˆç°¡å˜ï¼‰ï¼ SELinuxï¼ˆå¼·åŠ›ï¼‰ |
| **Red Hatç³»OSï¼ˆRHEL/CentOS/Fedoraï¼‰** | SELinux |
| **Debian/Ubuntuç³»** | AppArmor |
| **æœ€ã‚‚ç°¡å˜ã«å§‹ã‚ã‚‹** | Seccomp RuntimeDefault |

---

## eBPF â€• ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç›£è¦–ã®é©å‘½

### eBPFã¨ã¯ï¼Ÿ

**Extended Berkeley Packet Filter**

ã‚«ãƒ¼ãƒãƒ«å†…ã§**å®‰å…¨ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œ**ã§ãã‚‹ä»•çµ„ã¿ã€‚

### å¾“æ¥ã®ç›£è¦– vs eBPF

#### âŒ å¾“æ¥ã®ç›£è¦–ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç©ºé–“ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User Space             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Monitoring Agent    â”‚  â”‚  â† ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«çµŒç”±ã§æƒ…å ±å–å¾—
â”‚  â”‚  (é«˜ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰) â”‚  â”‚     é…ã„ãƒ»è¦‹é€ƒã—ã‚ã‚Š
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ â†‘ â†‘ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Kernel Space           â”‚
â”‚    (å®Ÿéš›ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### âœ… eBPFï¼ˆã‚«ãƒ¼ãƒãƒ«å†…ç›£è¦–ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User Space             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Monitoring Agent    â”‚  â”‚
â”‚  â”‚  (çµæœã‚’å—ã‘å–ã‚‹ã ã‘) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Kernel Space           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  eBPF Program        â”‚  â”‚  â† ã“ã“ã§ç›£è¦–
â”‚  â”‚  (ã‚«ãƒ¼ãƒãƒ«å†…å®Ÿè¡Œ)     â”‚  â”‚     è¶…ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### eBPFã§ç›£è¦–ã§ãã‚‹ã“ã¨

#### 1ï¸âƒ£ ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç›£è¦–

```c
// eBPFãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¾‹ï¼ˆç°¡ç•¥ç‰ˆï¼‰
SEC("tracepoint/syscalls/sys_enter_execve")
int trace_execve(struct trace_event_raw_sys_enter *ctx)
{
    // execveã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã‚’æ¤œçŸ¥
    char comm[16];
    bpf_get_current_comm(&comm, sizeof(comm));

    // æ€ªã—ã„ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚’æ¤œçŸ¥
    if (strstr(comm, "nc") || strstr(comm, "nmap")) {
        bpf_printk("Suspicious command: %s\n", comm);
        return 1;  // ãƒ–ãƒ­ãƒƒã‚¯å¯èƒ½
    }
    return 0;
}
```

#### 2ï¸âƒ£ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç›£è¦–

```c
SEC("kprobe/vfs_open")
int trace_open(struct pt_regs *ctx)
{
    // æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œçŸ¥
    char filename[256];
    // ...
    if (strstr(filename, "/etc/shadow")) {
        bpf_printk("Access to /etc/shadow detected!\n");
    }
}
```

#### 3ï¸âƒ£ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–

```c
SEC("kprobe/tcp_connect")
int trace_tcp_connect(struct pt_regs *ctx)
{
    // å¤–éƒ¨ã¸ã®ä¸å¯©ãªæ¥ç¶šã‚’æ¤œçŸ¥
    u32 daddr;  // å®›å…ˆIPã‚¢ãƒ‰ãƒ¬ã‚¹
    u16 dport;  // å®›å…ˆãƒãƒ¼ãƒˆ

    // ä¾‹ï¼šä¸­å›½ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®æ¥ç¶šã‚’æ¤œçŸ¥
    if (is_suspicious_ip(daddr)) {
        bpf_printk("Suspicious connection to %x:%d\n", daddr, dport);
    }
}
```

---

### eBPFã‚’ä½¿ã£ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«

#### Falcoï¼ˆæœ€ã‚‚æœ‰åï¼‰

```yaml
# Falcoãƒ«ãƒ¼ãƒ«ä¾‹
- rule: Reverse Shell Detected
  desc: Detect common reverse shell patterns
  condition: >
    spawned_process and
    (proc.name in (nc, ncat, netcat, bash, sh) and
     (proc.args contains "-e" or proc.args contains "-c"))
  output: >
    Reverse shell detected (user=%user.name command=%proc.cmdline)
  priority: CRITICAL
```

#### Ciliumï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒªã‚·ãƒ¼ + ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰

- eBPFãƒ™ãƒ¼ã‚¹ã®Kubernetes CNI
- L3-L7ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒãƒªã‚·ãƒ¼
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç›£è¦–

#### Tetragonï¼ˆCiliumã®é€²åŒ–ç‰ˆï¼‰

- ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œç›£è¦–
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç›£è¦–
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šç›£è¦–
- **ã™ã¹ã¦eBPFã§å®Ÿè¡Œ**

---

### eBPFã®é©å‘½çš„ãªç‚¹

| å¾“æ¥ã®ç›£è¦– | eBPF |
|----------|------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç©ºé–“ã§å‹•ä½œ | **ã‚«ãƒ¼ãƒãƒ«å†…ã§å‹•ä½œ** |
| ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ | **ã»ã¼ã‚¼ãƒ­ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰** |
| è¦‹é€ƒã—ã‚ã‚Š | **ã™ã¹ã¦ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒƒãƒ** |
| å¾Œä»˜ã‘ã®ç›£è¦– | **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ–ãƒ­ãƒƒã‚¯å¯èƒ½** |

ğŸ‘‰ **eBPFã¯ã€Œç›£è¦–ã€ã‹ã‚‰ã€Œé˜²å¾¡ã€ã¸ã®ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‚·ãƒ•ãƒˆ**

---

## ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã§ã®é˜²å¾¡æˆ¦ç•¥ â€• å¤šå±¤é˜²å¾¡

### Defense in Depthï¼ˆå¤šå±¤é˜²å¾¡ï¼‰

å˜ä¸€ã®é˜²å¾¡ã«é ¼ã‚‰ãšã€**è¤‡æ•°ã®å±¤ã§é˜²å¾¡**ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 7: ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç›£è¦– (eBPF/Falco) â”‚  â† å®Ÿè¡Œæ™‚ã®ç•°å¸¸æ¤œçŸ¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 6: ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«åˆ¶é™ (Seccomp)â”‚  â† å±é™ºãªæ“ä½œã‚’ç¦æ­¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 5: ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ (AppArmor/SELinux)â”‚ â† ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 4: ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ (Cgroup)      â”‚  â† DoSæ”»æ’ƒé˜²æ­¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 3: ãƒ—ãƒ­ã‚»ã‚¹éš”é›¢ (Namespace)   â”‚  â† è«–ç†çš„åˆ†é›¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: ã‚³ãƒ³ãƒ†ãƒŠãƒ©ãƒ³ã‚¿ã‚¤ãƒ          â”‚  â† containerd / CRI-O
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: Linux Kernel              â”‚  â† ã‚«ãƒ¼ãƒãƒ«ã®è„†å¼±æ€§å¯¾ç­–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### å®Ÿè·µï¼šå¼·åŒ–ã•ã‚ŒãŸPod Security

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: hardened-pod
  annotations:
    # AppArmoré©ç”¨
    container.apparmor.security.beta.kubernetes.io/app: localhost/docker-default
spec:
  # SELinuxè¨­å®š
  securityContext:
    seLinuxOptions:
      level: "s0:c123,c456"
    # Seccompé©ç”¨
    seccompProfile:
      type: RuntimeDefault
    # érootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å®Ÿè¡Œ
    runAsNonRoot: true
    runAsUser: 1000
    # ç‰¹æ¨©ãƒ¢ãƒ¼ãƒ‰ç¦æ­¢
    allowPrivilegeEscalation: false
    # rootãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã«
    readOnlyRootFilesystem: true
    # Capabilitieså‰Šæ¸›
    capabilities:
      drop:
        - ALL
      add:
        - NET_BIND_SERVICE  # ãƒãƒ¼ãƒˆ80/443ã®ãƒã‚¤ãƒ³ãƒ‰ã®ã¿è¨±å¯

  containers:
  - name: app
    image: myapp:latest
    # ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
    resources:
      limits:
        cpu: "500m"
        memory: "512Mi"
        pids: "100"  # ãƒ—ãƒ­ã‚»ã‚¹æ•°åˆ¶é™
      requests:
        cpu: "250m"
        memory: "256Mi"
```

---

### Kubernetes Pod Security Standards

Kubernetes 1.25+ã§ã¯ã€**Pod Security Admission**ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã§ã™ã€‚

#### 3ã¤ã®ãƒ¬ãƒ™ãƒ«

| ãƒ¬ãƒ™ãƒ« | åˆ¶é™å†…å®¹ |
|--------|---------|
| **Privileged** | åˆ¶é™ãªã—ï¼ˆéæ¨å¥¨ï¼‰ |
| **Baseline** | åŸºæœ¬çš„ãªåˆ¶é™ï¼ˆç‰¹æ¨©ã‚³ãƒ³ãƒ†ãƒŠç¦æ­¢ãªã©ï¼‰ |
| **Restricted** | å³æ ¼ãªåˆ¶é™ï¼ˆã™ã¹ã¦ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ï¼‰ |

#### é©ç”¨ä¾‹

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: production
  labels:
    pod-security.kubernetes.io/enforce: restricted
    pod-security.kubernetes.io/audit: restricted
    pod-security.kubernetes.io/warn: restricted
```

---

## ã¾ã¨ã‚ â€• ãªãœã‚³ãƒ³ãƒ†ãƒŠã¯"ä¿¡ç”¨ã§ããªã„"ã®ã‹

### ç­”ãˆ

> **ã‚³ãƒ³ãƒ†ãƒŠã¯ã€Œã‚«ãƒ¼ãƒãƒ«ã«ã‚ˆã£ã¦éš”é›¢ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã€ã«éããšã€**
> **ã‚«ãƒ¼ãƒãƒ«ã‚’å…±æœ‰ã—ã¦ã„ã‚‹ä»¥ä¸Šã€å®Œå…¨ãªéš”é›¢ã¯ä¸å¯èƒ½ã€‚**

### é‡è¦ãªèªè­˜

1. **Namespaceã¯ã€Œè¦‹ãŸç›®ä¸Šã®éš”é›¢ã€**
   - ã‚«ãƒ¼ãƒãƒ«ã¯å…±æœ‰ã•ã‚Œã¦ã„ã‚‹
   - è„†å¼±æ€§ãŒã‚ã‚Œã°ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å¯èƒ½

2. **Cgroupã¯ã€Œãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ã€**
   - ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã§ã¯ãªã„
   - DoSæ”»æ’ƒã®é˜²æ­¢ã«ã¯æœ‰åŠ¹

3. **Seccomp/AppArmor/SELinuxãŒã€Œæœ¬å½“ã®é˜²å¾¡ã€**
   - ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’åˆ¶é™
   - ã“ã‚ŒãŒç„¡ã‘ã‚Œã°å±é™º

4. **eBPFã¯ã€Œæ¬¡ä¸–ä»£ã®ç›£è¦–ãƒ»é˜²å¾¡ã€**
   - ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã§ã®ç›£è¦–
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®ãƒ–ãƒ­ãƒƒã‚¯

5. **å¤šå±¤é˜²å¾¡ãŒçµ¶å¯¾ã«å¿…è¦**
   - å˜ä¸€ã®é˜²å¾¡ã§ã¯ä¸ååˆ†
   - ã™ã¹ã¦ã®å±¤ã‚’çµ„ã¿åˆã‚ã›ã‚‹

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å®Ÿè·µã™ã¹ãã“ã¨

1. **Pod Security Standardsã‚’å°å…¥**
   - ã¾ãšã¯ `baseline` ã‹ã‚‰
   - å¾ã€…ã« `restricted` ã¸ç§»è¡Œ

2. **Seccomp RuntimeDefaultã‚’æœ‰åŠ¹åŒ–**
   - Kubernetes 1.27+ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåŒ–
   - ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…è¦ã«å¿œã˜ã¦

3. **Falco / Tetragonã‚’å°å…¥**
   - ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç›£è¦–ã‚’é–‹å§‹
   - ç•°å¸¸ãªæŒ™å‹•ã‚’æ¤œçŸ¥

4. **ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ã®å¾¹åº•**
   - Trivy / Grype ãªã©ã§ãƒ“ãƒ«ãƒ‰æ™‚ã«ã‚¹ã‚­ãƒ£ãƒ³
   - è„†å¼±æ€§ã®ã‚ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãªã„

5. **Network Policyã®é©ç”¨**
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Deny All
   - å¿…è¦ãªé€šä¿¡ã®ã¿è¨±å¯

---

## å‚è€ƒæ–‡çŒ®

1. **Linux Kernel Documentation**
   - [Namespaces](https://man7.org/linux/man-pages/man7/namespaces.7.html)
   - [Cgroups](https://www.kernel.org/doc/Documentation/cgroup-v2.txt)
   - [Seccomp](https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt)

2. **Kuberneteså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**
   - [Pod Security Standards](https://kubernetes.io/docs/concepts/security/pod-security-standards/)
   - [Security Context](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)

3. **eBPF**
   - [eBPF.io - Official Documentation](https://ebpf.io/)
   - [Cilium Documentation](https://docs.cilium.io/)

4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«**
   - [Falco](https://falco.org/)
   - [Tetragon](https://tetragon.io/)
   - [Docker Seccomp Profile](https://github.com/moby/moby/blob/master/profiles/seccomp/default.json)

5. **CVEäº‹ä¾‹**
   - [CVE-2019-5736 (runc vulnerability)](https://nvd.nist.gov/vuln/detail/CVE-2019-5736)
   - [CVE-2022-0847 (Dirty Pipe)](https://nvd.nist.gov/vuln/detail/CVE-2022-0847)

---

## é–¢é€£è¨˜äº‹

- [Kubernetesã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®æœ¬è³ª â€• ãªãœãƒ©ãƒ³ã‚¿ã‚¤ãƒ é˜²å¾¡ãŒå¿…è¦ãªã®ã‹](https://qiita.com/keitah/items/c25440de24eea858a24b)ï¼ˆå‰æè¨˜äº‹ï¼‰
- ãªãœä»Šã€æ—¥æœ¬ä¼æ¥­ã¯Kubernetesã«èˆµã‚’åˆ‡ã‚‹ã®ã‹ â€• DXãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»äººæã®ä¸‰é‡åœ§
- ã€Œã“ã†ã—ã‚ã€vsã€Œã“ã†ã‚ã‚‹ã¹ãã€IaCæ€æƒ³ã®æœ¬è³ªã¨å®Ÿå‹™ã§ã®ä½¿ã„åˆ†ã‘
