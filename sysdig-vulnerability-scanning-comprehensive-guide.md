# Sysdig 脆弱性スキャン完全ガイド：CLI Scanner とレジストリスキャンの全貌

## 目次

1. [はじめに](#はじめに)
2. [Sysdig CLI Scanner 概要](#sysdig-cli-scanner-概要)
3. [Sysdig CLI Scanner アーキテクチャ](#sysdig-cli-scanner-アーキテクチャ)
4. [動作モード](#動作モード)
5. [レジストリスキャン](#レジストリスキャン)
6. [SBOM と脆弱性検出メカニズム](#sbom-と脆弱性検出メカニズム)
7. [Pipeline vs Runtime スキャン](#pipeline-vs-runtime-スキャン)
8. [CI/CD 統合](#cicd-統合)
9. [ポリシーと評価](#ポリシーと評価)
10. [ベストプラクティス](#ベストプラクティス)
11. [2025年の最新アップデート](#2025年の最新アップデート)

---

## はじめに

コンテナ化されたアプリケーションのセキュリティは、現代のDevOpsとクラウドネイティブ環境において最重要課題の一つです。Sysdig は、包括的な脆弱性管理プラットフォームを提供し、開発からランタイムまでのライフサイクル全体にわたってセキュリティを確保します。

本記事では、Sysdig の主要なスキャン機能である **CLI Scanner** と **レジストリスキャン** について、アーキテクチャ、機能、実装方法を詳細に解説します。

---

## Sysdig CLI Scanner 概要

### 基本情報

**Sysdig Vulnerability CLI Scanner (`sysdig-cli-scanner`)** は、コンテナイメージとディレクトリを手動でスキャンするための多機能ツールです。ローカルまたはリモートに配置されたイメージやファイルシステムを分析し、脆弱性を検出します。

### 主な特徴

| 特徴 | 説明 |
|------|------|
| **シングルバイナリ** | 依存関係不要で、どこでも実行可能 |
| **マルチプラットフォーム** | Linux (amd64/arm64), macOS (Intel/Apple Silicon), Windows対応 |
| **デュアルモード** | VM（Vulnerability Management）モードとIaCモード |
| **スタンドアロン実行** | バックエンド接続なしでも動作可能 |
| **柔軟な出力** | コンソール、JSON、CSV形式でのレポート出力 |
| **CI/CD統合** | Exit codeによるパイプライン制御 |

### ダウンロードとインストール

```bash
# 作業ディレクトリの作成
mkdir -p ~/sysdig-scanner
cd ~/sysdig-scanner

# 最新バージョンの取得
LATEST_VERSION=$(curl -L -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)

# macOS (Intel) の場合
curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${LATEST_VERSION}/darwin/amd64/sysdig-cli-scanner"

# macOS (Apple Silicon) の場合
curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${LATEST_VERSION}/darwin/arm64/sysdig-cli-scanner"

# Linux (AMD64) の場合
curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${LATEST_VERSION}/linux/amd64/sysdig-cli-scanner"

# 実行権限の付与
chmod +x ./sysdig-cli-scanner

# バージョン確認
./sysdig-cli-scanner --version
```

---

## Sysdig CLI Scanner アーキテクチャ

### スキャンフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Sysdig CLI Scanner                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────┐
         │  1. イメージ/ディレクトリの取得    │
         │     - Docker                       │
         │     - ContainerD                   │
         │     - Remote Registry              │
         │     - Local Filesystem             │
         └────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────┐
         │  2. SBOM (Software Bill of         │
         │     Materials) の生成              │
         │     - OS パッケージ分析            │
         │     - 言語ライブラリ検出           │
         │     - レイヤー分析                 │
         └────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────┐
         │  3. 脆弱性データベースとの照合     │
         │     - NVD (National Vulnerability  │
         │       Database)                    │
         │     - ベンダー提供の脆弱性情報     │
         │     - CISA KEV                     │
         │     - 15+ Threat Feeds             │
         └────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────┐
         │  4. ポリシー評価                   │
         │     - Severity ベースのルール      │
         │     - コンプライアンス要件         │
         │     - カスタムポリシー             │
         └────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────┐
         │  5. 結果の出力                     │
         │     - コンソール表示               │
         │     - JSON/CSV ファイル            │
         │     - Sysdig Secure バックエンド   │
         └────────────────────────────────────┘
```

### コンテナランタイムサポート

Sysdig CLI Scanner は、複数のコンテナランタイムに対応しています：

- **Docker**: ローカルのDocker Daemonからイメージを取得
- **ContainerD**: Kubernetesなどで使用されるContainerD
- **Remote Registry**: プル可能なリモートレジストリ
- **OCI Image Layout**: OCI標準フォーマットのイメージ

スキャナーは自動的にローカルイメージを探し、見つからない場合はリモートレジストリからプルを試みます。

### 脆弱性データベース

初回実行時、約 **215.6 MB** の脆弱性データベースがダウンロードされます。このデータベースには以下が含まれます：

- **CVE (Common Vulnerabilities and Exposures)** データ
- **OS ベンダー提供の脆弱性情報**（Debian, Ubuntu, Alpine, Red Hat, CentOS など）
- **言語固有の脆弱性データ**（npm, pip, Maven, Go modules など）
- **エクスプロイト情報**
- **修正バージョン情報**

データベースはキャッシュされ、次回以降は高速にスキャンが実行されます。

---

## 動作モード

Sysdig CLI Scanner は、2つの主要な動作モードを提供します。

### 1. VM (Vulnerability Management) モード

**目的**: コンテナイメージの脆弱性スキャン

**使用例**:
```bash
# APIトークンの設定
export SECURE_API_TOKEN="your-api-token"

# 基本的なスキャン
./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com nginx:latest

# 詳細な脆弱性リストを表示
./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com \
  --full-vulns-table nginx:latest

# レイヤー別の情報を表示
./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com \
  --separate-by-layer nginx:latest

# イメージ別の情報を表示
./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com \
  --separate-by-image nginx:latest
```

**主な機能**:
- **OS パッケージの脆弱性検出**: apt, yum, apk などでインストールされたパッケージ
- **言語ライブラリの脆弱性検出**: npm, pip, gem, Maven, Go modules など
- **レイヤー分析**: Dockerイメージの各レイヤーで追加されたパッケージを追跡
- **修正提案**: 利用可能な修正バージョンの提示

**レート制限**: 1分あたり **120 コンテナイメージ**

### 2. IaC (Infrastructure as Code) モード

**目的**: Infrastructure as Code リソースのセキュリティとコンプライアンススキャン

**使用例**:
```bash
# Terraform ファイルのスキャン
./sysdig-cli-scanner --iac /path/to/terraform/directory

# Kubernetes マニフェストのスキャン
./sysdig-cli-scanner --iac /path/to/kubernetes/manifests

# CloudFormation テンプレートのスキャン
./sysdig-cli-scanner --iac /path/to/cloudformation
```

**検出項目**:
- **セキュリティ設定の問題**: 過度な権限、暗号化の欠如など
- **コンプライアンス違反**: CIS Benchmarks, PCI-DSS, HIPAA など
- **ベストプラクティス違反**: リソースタグの欠如、コスト最適化など

### 3. スタンドアロンモード

**目的**: Sysdig バックエンドに接続せずにローカルでスキャン

**使用例**:
```bash
# スタンドアロンモードでスキャン
./sysdig-cli-scanner --standalone alpine:latest

# アップロードをスキップ
./sysdig-cli-scanner --standalone --skipupload nginx:latest

# オフラインアナライザーを使用
./sysdig-cli-scanner --standalone --offline-analyzer myapp:latest
```

**注意**: スタンドアロンモードでも、初回実行時は脆弱性データベースのダウンロードが必要です。完全なオフライン環境では、事前にデータベースをダウンロードしておく必要があります。

---

## レジストリスキャン

### 概要

Sysdig のレジストリスキャン機能は、コンテナレジストリに保存されているイメージを自動的にスキャンします。これにより、レジストリに push されたイメージが自動的に分析され、脆弱性が検出されます。

### サポートされているレジストリ

| レジストリ | サポート状況 | 特記事項 |
|-----------|-------------|---------|
| **Amazon ECR** | ✅ フルサポート | Single Registry / Organizational Scanning |
| **Azure ACR** | ✅ フルサポート | CVE + 3rd party libraries |
| **Google GCR/Artifact Registry** | ✅ フルサポート | - |
| **Docker Hub** | ✅ フルサポート | Public / Private リポジトリ |
| **JFrog Artifactory** | ✅ フルサポート | Docker V2 API 互換 |
| **Harbor** | ✅ フルサポート | VMware Harbor |
| **Quay.io** | ✅ フルサポート | CoreOS Quay |
| **GitLab Container Registry** | ✅ フルサポート | - |
| **GitHub Container Registry** | ✅ フルサポート | ghcr.io |

基本的に、**Docker V2 API** に互換性のあるレジストリであれば、Sysdig でスキャン可能です。

### Amazon ECR スキャン

#### アーキテクチャ

```
┌───────────────────┐
│   Developer       │
│   pushes image    │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│   Amazon ECR      │
│   Registry        │
└─────────┬─────────┘
          │
          │ EventBridge
          ▼
┌───────────────────┐
│   AWS CodeBuild   │ ← Ephemeral Pipeline
│   (Inline Scan)   │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│   Sysdig Secure   │
│   Backend         │
└───────────────────┘
```

#### 特徴

1. **自動トリガー**: ECRにイメージがpushされると、EventBridgeがトリガーされる
2. **エフェメラルパイプライン**: 各スキャンごとにCodeBuildパイプラインが一時的に作成される
3. **インラインスキャン**: イメージはECRから移動せず、その場でスキャンされる
4. **ポリシー評価**: 定義されたポリシーに基づいて自動評価

#### セットアップ手順

```bash
# 1. Sysdig Secure API トークンをSecrets Managerに保存
aws secretsmanager create-secret \
  --name sysdig-secure-api-token \
  --secret-string "your-api-token"

# 2. CloudFormation テンプレートをデプロイ
aws cloudformation create-stack \
  --stack-name sysdig-ecr-scanner \
  --template-url https://s3.amazonaws.com/sysdig-cloudformation/sysdig-ecr-scanner.yaml \
  --parameters \
    ParameterKey=SysdigSecureAPIToken,ParameterValue=sysdig-secure-api-token \
    ParameterKey=SysdigSecureEndpoint,ParameterValue=https://us2.app.sysdig.com

# 3. スキャン対象のECRリポジトリを指定（オプション）
# すべてのリポジトリをスキャンするか、特定のリポジトリのみを選択可能
```

#### Organizational Scanning

複数のAWSアカウントにまたがるECRをスキャンする場合：

```bash
# 1. 組織のマスターアカウントにSysdig Scanner Stack をデプロイ
# 2. 各メンバーアカウントでEventBridgeルールを設定
# 3. マスターアカウントのイベントバスにイベントを転送
```

### Azure ACR スキャン

#### 特徴

- **CVE 検出**: OS パッケージとサードパーティライブラリの脆弱性
- **15+ Threat Feeds**: 複数の脅威インテリジェンスソースからの情報統合
- **コンプライアンス**: Azure Policy との統合

#### セットアップ

```bash
# 1. Sysdig Registry Scanner をデプロイ
kubectl apply -f sysdig-registry-scanner.yaml

# 2. ACR の認証情報を設定
kubectl create secret docker-registry acr-credentials \
  --docker-server=myregistry.azurecr.io \
  --docker-username=<service-principal-id> \
  --docker-password=<service-principal-password>

# 3. Sysdig にレジストリを登録
# Sysdig Secure UI > Integrations > Container Registries > Add Registry
```

### スキャンの頻度とリフレッシュ

| スキャンタイプ | 頻度 | 説明 |
|--------------|------|------|
| **Push時スキャン** | イメージpush時 | 新しいイメージが追加された際に即座にスキャン |
| **定期スキャン** | 毎週土曜日 6:00 AM（デフォルト） | 新しい脆弱性データベースで既存イメージを再スキャン |
| **オンデマンドスキャン** | 手動実行 | Sysdig UI または API から手動でトリガー |

定期スキャンの頻度は、Helm Chart の cron job 設定で変更可能：

```yaml
# values.yaml
registryScanner:
  schedule: "0 6 * * 6"  # 毎週土曜日 6:00 AM
  # または
  # schedule: "0 */6 * * *"  # 6時間ごと
```

---

## SBOM と脆弱性検出メカニズム

### SBOM (Software Bill of Materials) とは

**SBOM** は、ソフトウェアコンポーネントの完全なリストであり、アプリケーションを構成するすべてのパッケージ、ライブラリ、依存関係を含みます。

#### SBOM の目的

1. **可視性と透明性**: アプリケーションの完全な構成を把握
2. **サプライチェーン管理**: すべての依存関係を追跡
3. **脆弱性管理**: コンポーネントの脆弱性を迅速に特定
4. **コンプライアンス**: ライセンス違反の検出
5. **インシデントレスポンス**: 影響範囲の迅速な把握

### Sysdig の SBOM 生成プロセス

```
┌─────────────────────────────────────────────────────────────┐
│  1. イメージ解析                                             │
│     - レイヤーの展開                                         │
│     - ファイルシステムの走査                                  │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│  2. パッケージマネージャー検出                                │
│     OS Level:                                                │
│       - apt (Debian/Ubuntu) → /var/lib/dpkg/status          │
│       - yum/dnf (RHEL/CentOS) → /var/lib/rpm                │
│       - apk (Alpine) → /lib/apk/db/installed                │
│     Language Level:                                          │
│       - npm → package.json, package-lock.json                │
│       - pip → requirements.txt, Pipfile.lock                 │
│       - Maven → pom.xml                                      │
│       - Go → go.mod, go.sum                                  │
│       - Ruby → Gemfile.lock                                  │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│  3. SBOM 生成 (CycloneDX JSON フォーマット)                  │
│     {                                                        │
│       "bomFormat": "CycloneDX",                              │
│       "specVersion": "1.4",                                  │
│       "components": [                                        │
│         {                                                    │
│           "type": "library",                                 │
│           "name": "openssl",                                 │
│           "version": "1.1.1n",                               │
│           "purl": "pkg:deb/debian/openssl@1.1.1n"            │
│         }                                                    │
│       ]                                                      │
│     }                                                        │
└───────────────────────┬─────────────────────────────────────┘
                        │
                        ▼
┌─────────────────────────────────────────────────────────────┐
│  4. Sysdig Backend に送信                                    │
└─────────────────────────────────────────────────────────────┘
```

### 脆弱性マッチングプロセス

Sysdig は生成された SBOM を複数の脅威インテリジェンスソースと照合します：

#### 1. CVE データソース

| ソース | 説明 |
|--------|------|
| **NVD (National Vulnerability Database)** | NISTが管理する米国政府の標準脆弱性データベース |
| **Debian Security Tracker** | Debian固有の脆弱性情報 |
| **Ubuntu Security Notices** | Ubuntuのセキュリティアップデート情報 |
| **RHEL Security Data** | Red Hat Enterprise Linux の脆弱性情報 |
| **Alpine SecDB** | Alpine Linux のセキュリティデータベース |
| **GitHub Advisory Database** | GitHub が管理する言語ライブラリの脆弱性情報 |
| **npm Security Advisories** | Node.js パッケージの脆弱性 |
| **PyPI Advisories** | Python パッケージの脆弱性 |
| **RubySec** | Ruby gem の脆弱性 |
| **Maven Central Security** | Java ライブラリの脆弱性 |

#### 2. CISA KEV (Known Exploited Vulnerabilities)

**CISA KEV** は、実際に悪用されていることが確認された脆弱性のカタログです。Sysdig はこのデータを統合し、以下を提供します：

- CVE ID
- 悪用されている信頼できる証拠
- 修正期限（Federal Agencies向け）
- 優先度の高いリスク評価

#### 3. 脆弱性スコアリング

Sysdig は従来の **CVSS (Common Vulnerability Scoring System)** を超えて、以下の要素を組み合わせてリスクを評価します：

```
┌──────────────────────────────────────────────────────────┐
│  Sysdig Risk Score = f(                                  │
│    CVSS Base Score,           // 基本的な脆弱性の深刻度   │
│    Exploitability,            // エクスプロイトの存在    │
│    Runtime Context,           // ランタイムでの使用状況  │
│    Package Reachability,      // パッケージの到達可能性  │
│    Network Exposure,          // ネットワーク露出度      │
│    Fixability                 // 修正可能性              │
│  )                                                        │
└──────────────────────────────────────────────────────────┘
```

**例**:
- **CVSS 9.8 (Critical)** の脆弱性でも、ランタイムで使用されていなければ優先度は下がる
- **CVSS 5.0 (Medium)** でも、実際にエクスプロイトが存在し、ネットワークに露出していれば優先度は上がる

### SBOM のダウンロード

Sysdig Secure UI から SBOM を **CycloneDX JSON** フォーマットでダウンロード可能：

1. **Vulnerabilities** メニューを開く
2. スキャン結果を選択
3. **Details** タブを開く
4. **Download SBOM** ボタンをクリック

APIを使用したダウンロード：

```bash
curl -X GET \
  "https://us2.app.sysdig.com/api/scanning/v1/results/${RESULT_ID}/sbom" \
  -H "Authorization: Bearer ${SECURE_API_TOKEN}" \
  -o sbom.json
```

---

## Pipeline vs Runtime スキャン

Sysdig は、ソフトウェア開発ライフサイクルの異なる段階で脆弱性スキャンを提供します。

### Pipeline スキャン

#### 概要

**Pipeline スキャン** は、CI/CD パイプライン内でイメージをビルド後、レジストリにpush する前に実行されるスキャンです。

#### 特徴

| 特徴 | 説明 |
|------|------|
| **タイミング** | ビルド直後、デプロイ前 |
| **スナップショット** | その時点での静的な脆弱性レポート |
| **コンテキスト** | ランタイムコンテキストなし |
| **目的** | 問題のあるイメージのデプロイをブロック |
| **頻度** | ビルドごとに1回 |

#### ユースケース

```bash
# CI/CD パイプラインの例
stages:
  - build
  - scan
  - deploy

scan_image:
  stage: scan
  script:
    - docker build -t myapp:${CI_COMMIT_SHA} .
    - ./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com myapp:${CI_COMMIT_SHA}
  allow_failure: false  # スキャン失敗時にパイプラインを停止
```

#### メリット

- ✅ 問題のあるイメージが本番環境に到達するのを防ぐ
- ✅ 開発初期段階で脆弱性を検出
- ✅ 修正コストが低い段階で対処
- ✅ デプロイ承認の自動化

#### デメリット

- ❌ ランタイムで実際に使用されるかわからない
- ❌ 新しい脆弱性が後から発見されても検知できない
- ❌ False Positive が多い可能性

### Runtime スキャン

#### 概要

**Runtime スキャン** は、実際に本番環境で稼働しているコンテナをスキャンします。

#### 特徴

| 特徴 | 説明 |
|------|------|
| **タイミング** | デプロイ後、実行中 |
| **コンテキスト** | ランタイムコンテキスト（実際に読み込まれたパッケージ） |
| **目的** | 実際のリスクの評価と優先順位付け |
| **頻度** | 1日2回（デフォルト） |

#### ランタイムコンテキストの重要性

```
┌────────────────────────────────────────────────────────────┐
│  イメージに含まれるパッケージ（Pipeline スキャン）          │
│                                                             │
│  ┌─────────────────────────────────────────────────┐      │
│  │ openssl (CVE-2023-XXXX)                         │      │
│  │ nginx                                            │      │
│  │ libcurl (CVE-2023-YYYY)                         │      │
│  │ python3                                          │      │
│  │ numpy                                            │      │
│  │ pandas (CVE-2023-ZZZZ)                          │      │
│  └─────────────────────────────────────────────────┘      │
└────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌────────────────────────────────────────────────────────────┐
│  ランタイムで実際に読み込まれたパッケージ                   │
│  （Runtime スキャン）                                       │
│                                                             │
│  ┌─────────────────────────────────────────────────┐      │
│  │ openssl (CVE-2023-XXXX) ← 実際に使用されている    │      │
│  │ nginx                                            │      │
│  │ libcurl (CVE-2023-YYYY) ← 使用されていない       │      │
│  └─────────────────────────────────────────────────┘      │
│                                                             │
│  → 実際のリスクは openssl の脆弱性のみ                     │
└────────────────────────────────────────────────────────────┘
```

#### メリット

- ✅ 実際のリスクに基づいた優先順位付け
- ✅ 新しく発見された脆弱性を継続的に検出
- ✅ False Positive の削減
- ✅ ネットワーク露出度などの追加コンテキスト

#### デメリット

- ❌ 問題が発見された時点で既にデプロイ済み
- ❌ 修正に時間とコストがかかる可能性

### 統合脆弱性管理 (2025年の進化)

Sysdig Secure の **統合脆弱性管理モジュール** は、以下のすべての段階からスキャン結果を統合します：

```
┌───────────┐    ┌───────────┐    ┌──────────────┐    ┌───────────┐
│ Pipeline  │───▶│ Registry  │───▶│  Admission   │───▶│  Runtime  │
│  Scan     │    │   Scan    │    │   Control    │    │   Scan    │
└───────────┘    └───────────┘    └──────────────┘    └───────────┘
      │                │                  │                   │
      └────────────────┴──────────────────┴───────────────────┘
                              │
                              ▼
                   ┌────────────────────────┐
                   │  統合ビュー             │
                   │  - 全段階の可視化       │
                   │  - リスクベースの優先順位│
                   │  - 統一ポリシー         │
                   └────────────────────────┘
```

#### 統一ポリシー

2025年のアップデートで、すべてのスキャン段階に適用可能な **統一ポリシー** が導入されました：

```yaml
# 統一ポリシーの例
policy:
  name: "Production Security Policy"
  applies_to:
    - pipeline
    - registry
    - admission_control
    - runtime
  rules:
    - condition: "severity >= HIGH AND fixable = true"
      action: FAIL
    - condition: "cisa_kev = true"
      action: FAIL
    - condition: "exploitable = true AND network_exposed = true"
      action: FAIL
```

---

## CI/CD 統合

### 統合の概要

Sysdig CLI Scanner は、主要なCI/CDプラットフォームとシームレスに統合できます：

| プラットフォーム | 統合方法 | 公式サポート |
|----------------|---------|------------|
| **Jenkins** | Plugin / Shell Script | ✅ Plugin 提供 |
| **GitHub Actions** | GitHub Action | ✅ Action 提供 |
| **GitLab CI** | Shell Script | ✅ Example 提供 |
| **Azure Pipelines** | Task / Shell Script | ✅ Example 提供 |
| **AWS CodeBuild** | buildspec.yml | ✅ Example 提供 |
| **Google Cloud Build** | cloudbuild.yaml | ✅ Example 提供 |
| **CircleCI** | Shell Script | ✅ Example 提供 |
| **Tekton** | Task | ✅ Example 提供 |

### Jenkins 統合

#### Jenkins Plugin 方式

**Sysdig Secure Container Image Scanner Plugin** を使用：

```groovy
pipeline {
    agent any

    environment {
        SECURE_API_TOKEN = credentials('sysdig-secure-token')
    }

    stages {
        stage('Build') {
            steps {
                sh 'docker build -t myapp:${BUILD_NUMBER} .'
            }
        }

        stage('Scan') {
            steps {
                sysdig engineCredentialsId: 'sysdig-secure-token',
                        engineurl: 'https://us2.app.sysdig.com',
                        name: 'myapp:${BUILD_NUMBER}',
                        bailOnFail: true,
                        bailOnPluginFail: true
            }
        }

        stage('Deploy') {
            when {
                expression { currentBuild.result == null || currentBuild.result == 'SUCCESS' }
            }
            steps {
                sh 'kubectl set image deployment/myapp myapp=myapp:${BUILD_NUMBER}'
            }
        }
    }

    post {
        always {
            // Sysdig レポートを Jenkins に添付
            archiveArtifacts artifacts: 'sysdig_secure_gates.json', allowEmptyArchive: true
        }
    }
}
```

#### Shell Script 方式

```groovy
pipeline {
    agent any

    environment {
        SECURE_API_TOKEN = credentials('sysdig-secure-token')
        SCANNER_VERSION = sh(script: 'curl -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt', returnStdout: true).trim()
    }

    stages {
        stage('Download Scanner') {
            steps {
                sh '''
                    curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${SCANNER_VERSION}/linux/amd64/sysdig-cli-scanner"
                    chmod +x sysdig-cli-scanner
                '''
            }
        }

        stage('Build') {
            steps {
                sh 'docker build -t myapp:${BUILD_NUMBER} .'
            }
        }

        stage('Scan') {
            steps {
                sh '''
                    ./sysdig-cli-scanner \
                        --apiurl=https://us2.app.sysdig.com \
                        --output=json-file=scan-result.json \
                        myapp:${BUILD_NUMBER}
                '''
            }
        }

        stage('Deploy') {
            steps {
                sh 'docker push myapp:${BUILD_NUMBER}'
            }
        }
    }
}
```

### GitHub Actions 統合

#### Sysdig Action 方式

```yaml
name: Build and Scan

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Build Docker image
        run: |
          docker build -t myapp:${{ github.sha }} .

      - name: Scan image with Sysdig
        uses: sysdiglabs/scan-action@v3
        with:
          image-tag: myapp:${{ github.sha }}
          sysdig-secure-token: ${{ secrets.SYSDIG_SECURE_TOKEN }}
          sysdig-secure-url: https://us2.app.sysdig.com
          dockerfile-path: ./Dockerfile
          input-type: docker-daemon
          ignore-failed-scan: false
          run-as-user: root

      - name: Upload scan results
        uses: github/codeql-action/upload-sarif@v2
        if: always()
        with:
          sarif_file: 'sysdig-scan-results.sarif'

      - name: Push to registry
        if: github.event_name == 'push'
        run: |
          echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
          docker push myapp:${{ github.sha }}
```

#### CLI Scanner 方式

```yaml
name: Build and Scan with CLI

on: [push, pull_request]

jobs:
  scan:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Build image
        run: docker build -t myapp:${{ github.sha }} .

      - name: Download Sysdig CLI Scanner
        run: |
          SCANNER_VERSION=$(curl -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)
          curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${SCANNER_VERSION}/linux/amd64/sysdig-cli-scanner"
          chmod +x sysdig-cli-scanner

      - name: Scan image
        env:
          SECURE_API_TOKEN: ${{ secrets.SYSDIG_SECURE_TOKEN }}
        run: |
          ./sysdig-cli-scanner \
            --apiurl=https://us2.app.sysdig.com \
            --full-vulns-table \
            --output=json-file=scan-result.json \
            myapp:${{ github.sha }}

      - name: Upload scan results as artifact
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: sysdig-scan-results
          path: scan-result.json
```

### GitLab CI 統合

```yaml
# .gitlab-ci.yml

variables:
  IMAGE_NAME: ${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHORT_SHA}
  SCANNER_VERSION: "latest"

stages:
  - build
  - scan
  - deploy

build_image:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker build -t ${IMAGE_NAME} .
    - docker save ${IMAGE_NAME} -o image.tar
  artifacts:
    paths:
      - image.tar
    expire_in: 1 hour

scan_image:
  stage: scan
  image: docker:latest
  services:
    - docker:dind
  before_script:
    - docker load -i image.tar
    - |
      SCANNER_VERSION=$(wget -qO- https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)
      wget -q "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${SCANNER_VERSION}/linux/amd64/sysdig-cli-scanner"
      chmod +x sysdig-cli-scanner
  script:
    - |
      ./sysdig-cli-scanner \
        --apiurl=${SYSDIG_SECURE_URL} \
        --output=json-file=scan-result.json \
        ${IMAGE_NAME}
  artifacts:
    reports:
      # GitLab Security Report 形式で出力（Enterprise版）
      container_scanning: scan-result.json
    paths:
      - scan-result.json
  allow_failure: false

deploy:
  stage: deploy
  script:
    - docker push ${IMAGE_NAME}
  only:
    - main
  needs:
    - build_image
    - scan_image
```

### Azure Pipelines 統合

```yaml
# azure-pipelines.yml

trigger:
  - main
  - develop

pool:
  vmImage: 'ubuntu-latest'

variables:
  imageName: 'myapp'
  imageTag: '$(Build.BuildId)'
  sysdigSecureUrl: 'https://us2.app.sysdig.com'

stages:
  - stage: Build
    jobs:
      - job: BuildImage
        steps:
          - task: Docker@2
            displayName: 'Build Docker image'
            inputs:
              command: 'build'
              Dockerfile: '**/Dockerfile'
              tags: '$(imageName):$(imageTag)'

  - stage: Scan
    dependsOn: Build
    jobs:
      - job: ScanImage
        steps:
          - script: |
              SCANNER_VERSION=$(curl -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)
              curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${SCANNER_VERSION}/linux/amd64/sysdig-cli-scanner"
              chmod +x sysdig-cli-scanner
            displayName: 'Download Sysdig CLI Scanner'

          - script: |
              ./sysdig-cli-scanner \
                --apiurl=$(sysdigSecureUrl) \
                --output=json-file=$(Build.ArtifactStagingDirectory)/scan-result.json \
                $(imageName):$(imageTag)
            displayName: 'Scan image with Sysdig'
            env:
              SECURE_API_TOKEN: $(SYSDIG_SECURE_TOKEN)

          - task: PublishBuildArtifacts@1
            displayName: 'Publish scan results'
            inputs:
              pathToPublish: '$(Build.ArtifactStagingDirectory)'
              artifactName: 'sysdig-scan-results'

  - stage: Deploy
    dependsOn: Scan
    condition: succeeded()
    jobs:
      - job: DeployImage
        steps:
          - task: Docker@2
            displayName: 'Push Docker image'
            inputs:
              command: 'push'
              tags: '$(imageName):$(imageTag)'
```

### AWS CodeBuild 統合

```yaml
# buildspec.yml

version: 0.2

phases:
  pre_build:
    commands:
      - echo Logging in to Amazon ECR...
      - aws ecr get-login-password --region $AWS_DEFAULT_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com
      - REPOSITORY_URI=$AWS_ACCOUNT_ID.dkr.ecr.$AWS_DEFAULT_REGION.amazonaws.com/$IMAGE_REPO_NAME
      - IMAGE_TAG=${CODEBUILD_RESOLVED_SOURCE_VERSION:0:7}
      - echo Downloading Sysdig CLI Scanner...
      - SCANNER_VERSION=$(curl -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)
      - curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${SCANNER_VERSION}/linux/amd64/sysdig-cli-scanner"
      - chmod +x sysdig-cli-scanner

  build:
    commands:
      - echo Build started on `date`
      - echo Building the Docker image...
      - docker build -t $REPOSITORY_URI:$IMAGE_TAG .

  post_build:
    commands:
      - echo Scanning image with Sysdig...
      - |
        ./sysdig-cli-scanner \
          --apiurl=$SYSDIG_SECURE_URL \
          --output=json-file=scan-result.json \
          $REPOSITORY_URI:$IMAGE_TAG
      - echo Scan completed. Pushing image...
      - docker push $REPOSITORY_URI:$IMAGE_TAG
      - echo Writing image definitions file...
      - printf '[{"name":"%s","imageUri":"%s"}]' $CONTAINER_NAME $REPOSITORY_URI:$IMAGE_TAG > imagedefinitions.json

artifacts:
  files:
    - imagedefinitions.json
    - scan-result.json
```

### Exit Code によるパイプライン制御

Sysdig CLI Scanner の Exit Code を使用して、パイプラインの動作を制御できます：

| Exit Code | 意味 | 推奨アクション |
|-----------|------|---------------|
| **0** | スキャン評価 Pass | パイプライン続行、デプロイ許可 |
| **1** | スキャン評価 Fail | パイプライン停止、デプロイブロック |
| **2** | 無効なパラメータ | パイプライン設定の修正 |
| **3** | 内部エラー | リトライまたは調査 |

**実装例**:

```bash
#!/bin/bash

# スキャン実行
./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com myapp:latest
EXIT_CODE=$?

case $EXIT_CODE in
  0)
    echo "✅ Scan PASSED. Proceeding to deployment..."
    deploy_to_production
    ;;
  1)
    echo "❌ Scan FAILED. Blocking deployment."
    notify_security_team
    exit 1
    ;;
  2)
    echo "⚠️  Invalid parameters. Check scanner configuration."
    exit 2
    ;;
  3)
    echo "🔥 Internal error. Retrying..."
    sleep 10
    ./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com myapp:latest
    ;;
esac
```

---

## ポリシーと評価

### ポリシーの概要

Sysdig の **脆弱性管理ポリシー** は、スキャン結果を評価し、Pass/Fail を判定するルールセットです。

### ポリシーの構成要素

```yaml
policy:
  name: "Production Security Policy"
  description: "本番環境デプロイ前のセキュリティ基準"

  scope:
    # ポリシーの適用範囲
    applies_to:
      - pipeline      # CI/CDパイプライン
      - registry      # レジストリスキャン
      - admission     # Admission Controller
      - runtime       # ランタイムスキャン

    # 対象イメージ
    images:
      - "myregistry.io/myapp/*"
      - "myregistry.io/services/*"

  rules:
    # ルール1: Critical脆弱性の禁止
    - name: "Block Critical Vulnerabilities"
      condition: "severity = CRITICAL"
      action: FAIL
      exceptions:
        # 例外: 特定のCVEを許可
        - cve: "CVE-2023-12345"
          reason: "修正版が利用不可、WAFで緩和済み"
          expires: "2025-12-31"

    # ルール2: 修正可能なHigh脆弱性の禁止
    - name: "Block Fixable High Vulnerabilities"
      condition: "severity = HIGH AND fixable = true"
      action: FAIL

    # ルール3: CISA KEV の禁止
    - name: "Block Known Exploited Vulnerabilities"
      condition: "cisa_kev = true"
      action: FAIL

    # ルール4: エクスプロイト可能な脆弱性の警告
    - name: "Warn on Exploitable Vulnerabilities"
      condition: "exploitable = true"
      action: WARN

    # ルール5: 古いイメージの警告
    - name: "Warn on Old Images"
      condition: "image_age > 90"  # 90日以上古い
      action: WARN
```

### ビルトインポリシー

Sysdig は、すぐに使用できるビルトインポリシーを提供します：

#### 1. Sysdig Best Practices

```
ルール:
- Critical 脆弱性: 無条件で FAIL
- High 脆弱性 (修正可能): FAIL
- CISA KEV: FAIL
- Medium 以下: PASS (警告のみ)

適用場面: 一般的なセキュリティベースライン
```

#### 2. PCI-DSS Compliance

```
ルール:
- すべての修正可能な脆弱性: FAIL
- ネットワーク露出のある脆弱性: FAIL
- 暗号化の脆弱性: FAIL

適用場面: 決済カード業界のコンプライアンス
```

#### 3. NIST 800-53

```
ルール:
- Critical/High 脆弱性: FAIL
- 脆弱性管理プロセスの文書化: 必須
- 定期スキャンの実施: 必須

適用場面: 米国政府機関向けセキュリティ基準
```

#### 4. CIS Benchmarks

```
ルール:
- 最小限の特権原則違反: FAIL
- 不要なパッケージのインストール: WARN
- セキュリティアップデートの未適用: FAIL

適用場面: CIS Docker/Kubernetes Benchmarks
```

### カスタムポリシーの作成

#### UI での作成

1. Sysdig Secure にログイン
2. **Policies** → **Vulnerability Management** → **Add Policy**
3. ポリシー名と説明を入力
4. **Scope** を設定（Pipeline, Registry, Runtime）
5. **Rules** を追加
6. **Save** をクリック

#### API での作成

```bash
curl -X POST \
  "https://us2.app.sysdig.com/api/v2/policies/vulnerabilities" \
  -H "Authorization: Bearer ${SECURE_API_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Custom Production Policy",
    "description": "本番環境向けカスタムポリシー",
    "isDefault": false,
    "scope": {
      "applies_to": ["pipeline", "runtime"],
      "images": ["myregistry.io/*"]
    },
    "rules": [
      {
        "name": "Block Critical",
        "condition": "severity = CRITICAL",
        "action": "FAIL"
      },
      {
        "name": "Block High with Exploit",
        "condition": "severity = HIGH AND exploitable = true",
        "action": "FAIL"
      }
    ]
  }'
```

### ポリシーの適用

#### CLI Scanner での明示的な指定

```bash
# 特定のポリシーを評価
./sysdig-cli-scanner \
  --apiurl=https://us2.app.sysdig.com \
  --policy=production-policy,compliance-policy \
  myapp:latest
```

#### Always Apply フラグ

**Always Apply** フラグが有効なポリシーは、明示的に指定しなくても常に評価されます：

```yaml
policy:
  name: "Critical Security Policy"
  always_apply: true  # 常に評価される
  rules:
    - condition: "cisa_kev = true"
      action: FAIL
```

### ポリシー評価結果の確認

#### コンソール出力

```
POLICIES EVALUATION
  Policy: Production Security Policy FAILED (15 failures - 2 risks accepted)
    ✓ Block Critical Vulnerabilities: PASSED
    ✗ Block Fixable High Vulnerabilities: FAILED (15 violations)
      - CVE-2023-12345 in openssl 1.1.1n (fix available: 1.1.1w)
      - CVE-2023-67890 in curl 7.74.0 (fix available: 7.74.0-1.3+deb11u2)
      ...
    ⚠ Warn on Old Images: WARNING (image is 120 days old)

Policies evaluation FAILED at 2025-11-28T10:30:00Z
```

#### JSON 出力

```json
{
  "policy_evaluation": {
    "policy_id": "production-security-policy",
    "policy_name": "Production Security Policy",
    "result": "FAILED",
    "evaluated_at": "2025-11-28T10:30:00Z",
    "rules": [
      {
        "rule_name": "Block Critical Vulnerabilities",
        "result": "PASSED",
        "violations": []
      },
      {
        "rule_name": "Block Fixable High Vulnerabilities",
        "result": "FAILED",
        "violations": [
          {
            "cve": "CVE-2023-12345",
            "package": "openssl",
            "version": "1.1.1n",
            "fix_version": "1.1.1w",
            "severity": "HIGH"
          }
        ]
      }
    ]
  }
}
```

---

## ベストプラクティス

### 1. イメージ選択のベストプラクティス

#### ✅ 推奨: 軽量なベースイメージを使用

```dockerfile
# ❌ 避けるべき: フル OS イメージ
FROM ubuntu:latest

# ✅ 推奨: 軽量な Alpine イメージ
FROM alpine:3.22

# ✅ さらに推奨: Distroless イメージ
FROM gcr.io/distroless/python3

# ✅ 最良: Scratch イメージ（Go など）
FROM scratch
COPY myapp /
ENTRYPOINT ["/myapp"]
```

**理由**:
- パッケージ数が少ない = 攻撃面が小さい
- 脆弱性の数が少ない
- イメージサイズが小さい
- スキャン時間が短い

**比較例**:

| ベースイメージ | サイズ | パッケージ数 | 脆弱性数（平均） |
|--------------|--------|------------|----------------|
| ubuntu:latest | 77 MB | ~200 | 50-100 |
| debian:slim | 69 MB | ~150 | 40-80 |
| alpine:latest | 7 MB | ~15 | 5-10 |
| distroless | 2-20 MB | ~10 | 2-5 |

#### ✅ 推奨: バージョンを固定

```dockerfile
# ❌ 避けるべき: latest タグ
FROM nginx:latest

# ✅ 推奨: 特定バージョンを指定
FROM nginx:1.29.3

# ✅ さらに推奨: ダイジェストで固定
FROM nginx:1.29.3@sha256:553f64aecdc31b5bf944521731cd70e35da4faed96b2b7548a3d8e2598c52a42
```

### 2. マルチステージビルドの活用

```dockerfile
# ビルドステージ: 開発ツールを含む
FROM golang:1.21 AS builder
WORKDIR /app
COPY . .
RUN go build -o myapp

# 実行ステージ: 必要最小限のみ
FROM alpine:3.22
COPY --from=builder /app/myapp /
ENTRYPOINT ["/myapp"]
```

**メリット**:
- 不要なビルドツールを最終イメージから除外
- イメージサイズの削減
- 脆弱性の削減

### 3. スキャンの頻度

| スキャンタイプ | 推奨頻度 | タイミング |
|--------------|---------|-----------|
| **Pipeline スキャン** | 毎ビルド | コミット/PR時 |
| **Registry スキャン** | 週1回 | 週末の深夜 |
| **Runtime スキャン** | 日2回 | 06:00, 18:00 |
| **オンデマンドスキャン** | 随時 | 重大な脆弱性発見時 |

### 4. 脆弱性の優先順位付け

```
優先度 1（即座に対応）:
├─ CISA KEV に掲載されている脆弱性
├─ Critical + エクスプロイト存在
└─ High + ネットワーク露出 + 修正可能

優先度 2（1週間以内）:
├─ Critical + 修正可能
├─ High + エクスプロイト存在
└─ High + 修正可能

優先度 3（1ヶ月以内）:
├─ High + 修正不可（代替策を検討）
├─ Medium + エクスプロイト存在
└─ Medium + ネットワーク露出

優先度 4（次回メンテナンス時）:
├─ Medium + 修正可能
├─ Low
└─ Negligible
```

### 5. False Positive への対応

#### 一時的な例外設定

```yaml
policy:
  rules:
    - name: "Block Critical"
      condition: "severity = CRITICAL"
      action: FAIL
      exceptions:
        - cve: "CVE-2023-12345"
          package: "openssl"
          reason: "修正版が安定性に問題あり。WAFで緩和済み"
          created_by: "security-team@company.com"
          expires: "2025-12-31"
```

#### リスク受容の文書化

```bash
# リスク受容の記録
curl -X POST \
  "https://us2.app.sysdig.com/api/v2/vulnerabilities/risks" \
  -H "Authorization: Bearer ${SECURE_API_TOKEN}" \
  -d '{
    "cve": "CVE-2023-12345",
    "accepted_by": "security-team@company.com",
    "reason": "本番環境では該当機能を使用しない",
    "expires": "2025-12-31",
    "compensating_controls": [
      "WAFルールで攻撃をブロック",
      "ネットワークセグメンテーション"
    ]
  }'
```

### 6. CI/CD パイプラインの設計

#### 推奨パイプライン構成

```
┌─────────────┐
│   Commit    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│    Build    │ ← マルチステージビルド
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Unit Tests  │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Vulnerability│ ← Sysdig CLI Scanner
│    Scan     │   (Block on Critical/High)
└──────┬──────┘
       │ Pass
       ▼
┌─────────────┐
│  Push to    │
│  Registry   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│ Integration │
│    Tests    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Deploy    │
│  Staging    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Approval   │ ← Manual approval for Prod
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   Deploy    │
│ Production  │
└─────────────┘
```

### 7. 脆弱性修正のワークフロー

```
1. 脆弱性検出
   └─ Sysdig がアラートを送信

2. トリアージ
   ├─ 優先度の評価
   ├─ 影響範囲の特定
   └─ 責任者のアサイン

3. 修正計画
   ├─ 修正バージョンの確認
   ├─ 互換性のテスト
   └─ ロールバック計画の作成

4. 修正実施
   ├─ Dockerfile の更新
   ├─ ビルド & スキャン
   └─ テスト環境でのデプロイ

5. 検証
   ├─ 脆弱性が修正されたことを確認
   ├─ 機能テスト
   └─ パフォーマンステスト

6. 本番デプロイ
   ├─ 段階的なロールアウト
   └─ モニタリング

7. 事後レビュー
   ├─ 修正時間の記録
   ├─ プロセスの改善
   └─ 再発防止策
```

### 8. セキュリティチームとの連携

#### 定期的なレビュー

```yaml
# 月次セキュリティレビュー
schedule: "毎月第1月曜日"
participants:
  - DevOps チーム
  - セキュリティチーム
  - アプリケーション所有者

agenda:
  - 脆弱性トレンドの確認
  - ポリシー違反の分析
  - 例外リクエストのレビュー
  - ポリシーの更新検討
  - ベストプラクティスの共有
```

#### アラート設定

```yaml
# Critical 脆弱性のアラート
alerts:
  - name: "Critical Vulnerability Detected"
    condition: "severity = CRITICAL"
    channels:
      - slack: "#security-alerts"
      - email: "security-team@company.com"
      - pagerduty: "security-oncall"

  - name: "CISA KEV Detected"
    condition: "cisa_kev = true"
    channels:
      - slack: "#security-critical"
      - email: "ciso@company.com"
      - pagerduty: "security-oncall"
    priority: "P1"
```

---

## 2025年の最新アップデート

### 1. Python パッケージマネージャー uv のサポート

**uv** は Astral 社が開発した高速な Python パッケージマネージャーです。2025年のアップデートで、Sysdig CLI Scanner が uv プロジェクトを完全にサポートするようになりました。

```bash
# uv プロジェクトのスキャン例
./sysdig-cli-scanner --apiurl=https://us2.app.sysdig.com \
  --project-file=uv.lock \
  myapp:latest
```

### 2. OS カバレッジの拡大

新たにサポートされた OS:

| OS | バージョン | 特記事項 |
|-----|----------|---------|
| **PhotonOS** | 3.x, 4.x, 5.x | VMware が開発する軽量コンテナ OS |
| **SUSE Linux** | SLES 12/15, openSUSE Leap | エンタープライズ Linux |

### 3. バージョンマッチング精度の向上

**改善内容**:
- 複雑なバージョン形式のサポート強化
- RHEL 固有のパッケージング処理の改善
- False Positive の削減
- False Negative の削減

**例**:
```
Before (2024):
  package: openssl 1.1.1n-0+deb11u3
  CVE-2023-12345 affects: 1.1.1n
  Result: ❌ False Negative (検出漏れ)

After (2025):
  package: openssl 1.1.1n-0+deb11u3
  CVE-2023-12345 affects: 1.1.1n-0+deb11u3
  Result: ✅ 正確に検出
```

### 4. 脆弱性データベースの最適化

- **ディスク使用量**: 30% 削減
- **メモリ消費**: 40% 削減
- **CPU 負荷**: 25% 削減
- **スキャン速度**: 平均 20% 高速化

### 5. 統合脆弱性管理ポリシー

**新機能**:
- すべてのスキャン段階（Pipeline, Registry, Admission, Runtime）に適用可能な統一ポリシー
- ポリシーの重複排除
- 設定の簡素化

**移行例**:
```
Before (2024):
  - Pipeline Policy (separate)
  - Registry Policy (separate)
  - Runtime Policy (separate)
  → 管理が煩雑、設定の不一致

After (2025):
  - Unified Policy
  → すべての段階で一貫性のあるポリシー
```

### 6. Legacy Scanning Engine の EOL

**重要**: Legacy Scanning Engine は **2024年12月31日** に End of Life に到達しました。

**移行が必要な場合**:
- Legacy Scanner を使用している場合
- 古い API を使用している場合

**移行手順**:
```bash
# 1. 現在のスキャナーバージョンを確認
./sysdig-cli-scanner --version

# 2. 最新バージョンにアップグレード
LATEST_VERSION=$(curl -s https://download.sysdig.com/scanning/sysdig-cli-scanner/latest_version.txt)
curl -LO "https://download.sysdig.com/scanning/bin/sysdig-cli-scanner/${LATEST_VERSION}/linux/amd64/sysdig-cli-scanner"

# 3. ポリシーの互換性確認
# Sysdig UI で Legacy ポリシーを新形式に変換

# 4. CI/CD パイプラインの更新
# 新しいスキャナーバイナリを使用するように更新
```

### 7. Runtime Context の強化

**新機能**:
- パッケージの到達可能性分析の強化
- ネットワーク露出度の自動検出
- プロセスレベルの脆弱性追跡

```
従来のスキャン:
  CVE-2023-12345 in openssl 1.1.1n
  Severity: CRITICAL

新しいRuntime Context:
  CVE-2023-12345 in openssl 1.1.1n
  Severity: CRITICAL
  Runtime Context:
    - Loaded: ✅ Yes (by nginx process)
    - Network Exposed: ✅ Yes (port 443)
    - Exploit Available: ✅ Yes
    - Reachability: HIGH
  → Adjusted Risk Score: 9.8 → 10.0 (Maximum Priority)
```

---

## まとめ

本記事では、Sysdig CLI Scanner とレジストリスキャンの全機能を詳細に解説しました。

### 主要なポイント

1. **包括的なスキャン**: Pipeline、Registry、Runtime の全段階をカバー
2. **柔軟な統合**: 主要な CI/CD プラットフォームとシームレスに統合
3. **正確な検出**: 15+ の脅威フィードからの情報統合
4. **コンテキストベースのリスク評価**: CVSS だけでなく、実際の使用状況を考慮
5. **自動化**: ポリシーベースの自動評価と承認/却下

### 次のステップ

1. **トライアル**: Sysdig Secure の無料トライアルを開始
2. **パイロットプロジェクト**: 1つのプロジェクトで CLI Scanner を導入
3. **ポリシー策定**: 組織のセキュリティ要件に基づいたポリシーを作成
4. **CI/CD 統合**: パイプラインにスキャンを組み込む
5. **展開**: 全プロジェクトに展開
6. **継続的改善**: スキャン結果を分析し、プロセスを改善

---

## 参考リンク

### 公式ドキュメント
- [Sysdig CLI Scanner Documentation](https://docs.sysdig.com/en/sysdig-secure/cli-scanner-vm-mode/)
- [Registry Scanning](https://docs.sysdig.com/en/docs/sysdig-secure/vulnerabilities/registry/)
- [Vulnerability Management](https://docs.sysdig.com/en/docs/sysdig-secure/vulnerabilities/)
- [Install CLI Scanner](https://docs.sysdig.com/en/sysdig-secure/install-vulnerability-cli-scanner/)

### CI/CD 統合
- [Jenkins Integration](https://docs.sysdig.com/en/sysdig-secure/jenkin-integration/)
- [GitHub Actions Integration](https://docs.sysdig.com/en/sysdig-secure/github-action-integration/)
- [Integrate with CI/CD Tools](https://docs.sysdig.com/en/docs/sysdig-secure/vulnerabilities/scanning/integrate-with-cicd-tools/)
- [Sysdig Vulnerability Scan Examples](https://sysdiglabs.github.io/secure-inline-scan-examples/)

### ブログ記事
- [AWS ECR Scanning with Sysdig Secure](https://www.sysdig.com/blog/aws-ecr-scanning)
- [Container Image Scanning on Jenkins](https://www.sysdig.com/blog/docker-scanning-jenkins)
- [Scanning images in Azure Container Registry](https://www.sysdig.com/blog/scanning-images-in-azure-container-registry)
- [What is a Software Bill of Materials (SBOM)?](https://www.sysdig.com/learn-cloud-native/what-is-a-software-bill-of-materials-sbom)
- [SBOM 101](https://www.sysdig.com/blog/sbom-101-software-bill-of-materials)

### レジストリ統合
- [Integrate with Container Registries](https://docs.sysdig.com/en/docs/sysdig-secure/vulnerabilities/scanning/integrate-with-container-registries/)

### リリースノート
- [What's new in Sysdig — April 2025](https://www.sysdig.com/blog/whats-new-in-sysdig-april-2025)
- [SaaS: Sysdig Secure Release Notes](https://docs.sysdig.com/en/release-notes/saas-sysdig-secure-release-notes/)

---

**著者**: Generated with Claude Code
**最終更新**: 2025-11-28
**バージョン**: 1.0
