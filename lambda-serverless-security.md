---
title: Lambdaは果たして安全か？― サーバレスの"見えないリスク"を解剖する
tags:
  - AWS
  - Lambda
  - Security
  - Serverless
  - CNAPP
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---

クラウドネイティブの時代、サーバレスは「安全な選択肢」として語られることが多くなりました。

特に AWS Lambda の登場以降、

- サーバ管理は不要
- パッチ適用は不要
- OSを触らない
- 自動スケールする

という言葉が並びます。

まるで、「インフラから解放されれば、セキュリティリスクも消える」かのように。

しかし本当にそうでしょうか？

この記事では、**Lambdaは本当に安全なのか？** という問いを、Runtimeの観点から掘り下げていきます。

---

## ① サーバレス神話

まずは、サーバレスに対する"安心感"の正体を整理します。

### ■ サーバ管理不要

EC2のようにOSへログインする必要はありません。パッチ適用、ディスク管理、プロセス監視も不要。

「SSHを閉じる」どころか、そもそもSSHが存在しない。

これは確かに大きなセキュリティ向上です。

### ■ パッチ不要

OSの脆弱性？ ミドルウェアの更新？

それはAWS側が管理してくれます。利用者はアプリコードに集中できる。

ここもまた、従来の運用負担を劇的に減らしました。

### ■ OSを触らない

root権限？ カーネル？ iptables？

考える必要がありません。攻撃者がOSレベルで侵入する余地は従来より大きく減っています。

### ■ 自動スケール

負荷が増えれば自動でスケールする。DoS耐性も上がる。インフラの"弱点"は、確かに減っています。

---

### では、もう安全なのか？

ここで重要な問いがあります。

> **「インフラを触らない = セキュリティ責任が消える」わけではない。**

AWSはインフラを守ります。しかし、

- あなたのコード
- あなたのIAM設定
- あなたのデータアクセス設計
- あなたのイベントフロー

までは守ってくれません。

サーバレスは **"責任共有モデルが消えた" のではなく、責任の重心が移動しただけ** なのです。

---

## ② Lambdaの"本当の攻撃面"

サーバが消えたなら、攻撃も消えたのでしょうか？

**答えはNoです。**

攻撃面は消えていません。形を変えただけです。

### ■ API Gateway経由の不正入力

Lambdaの多くはAPI Gatewayから呼ばれます。

- SQLインジェクション
- コマンドインジェクション
- JSONパース悪用
- 型混乱

これらは依然として存在します。

### ■ IAM過剰権限

Lambdaは実行ロールを持ちます。もしそのロールが：

```
s3:*
dynamodb:*
kms:*
```

のように広すぎる場合、攻撃者はコード実行さえできればクラウド全体を操作できます。

### ■ 環境変数からのSecrets漏洩

Lambdaでは環境変数に：

- APIキー
- DBパスワード
- 外部サービスToken

が入っているケースも多い。入力悪用や例外ログ出力で漏洩するリスクがあります。

### ■ S3へのデータ流出

Lambdaはデータ処理の中心になります。

1. 機密データ取得
2. 加工
3. 外部送信

これが悪用されたら？ "正常動作"のように見えてデータが抜かれる可能性があります。

### ■ ライブラリ脆弱性

LambdaはZIPやコンテナでデプロイされます。依存パッケージのCVEが存在すればそこが入口になります。

### ■ Event Injection

SQS / SNS / EventBridge 経由で悪意あるイベントを投入される可能性もあります。

---

### 重要なポイント

Lambdaは「サーバ」ではありません。Lambdaは **コード実行環境** です。

つまり攻撃対象はインフラ層ではなく、

> **アプリ層 + Identity層**

に集中します。

---

## ③ 最大の問題 ― "見えない"

ここが本質です。Lambdaには次の特徴があります。

### ■ ホストが見えない

OSにログインできません。プロセス一覧も見えません。

### ■ プロセスが見えない

実行されたコードがどのようなプロセスを生成したのか。確認できません。

### ■ syscallが見えない

- ファイルアクセス
- ネットワーク接続
- 権限昇格

低レベルの挙動は観測できません。

### ■ 実行時間が短い

数百ms〜数秒で終了。フォレンジックも困難。

### ■ コンテナが瞬間生成される

エフェメラル。侵害痕跡が残りにくい。

---

> **「検知できないものを、安全と呼べるか？」**

---

## ④ 実際の侵害シナリオ ― すべてが"正常"に見える攻撃

ある典型的なLambda構成を想像してください。

```
API Gateway → Lambda → S3（機密データ）
```

実行ロールはやや広め（`s3:GetObject`）

### 攻撃の流れ

1. 攻撃者がAPIへ細工した入力を送る
2. Lambdaがそれを処理
3. 想定外のS3オブジェクトを取得
4. データを外部へ送信

このとき、

- エラーは出ない
- レイテンシも正常
- 例外ログも出ない
- スケールも正常

**APM上は完全に"Healthy"。しかし実際には、データは抜かれています。**

---

## ⑤ APMが見ている世界

APMが観測しているのは：

- レイテンシ
- エラーレート
- リクエスト数
- トレースの流れ

つまり、「どこが遅いか」「どこで失敗したか」は分かります。

しかし、

- なぜそのコードが実行されたのか
- そのアクセスは想定内だったのか
- 権限が濫用されたのか
- データが外部へ流れたのか

は分かりません。

> **APMは 健全性（Health） を見る。**
> **セキュリティは 逸脱（Deviation） を見る。**

ここに構造的な差があります。

---

## ⑥ Serverless × APM の構造的ギャップ

Lambda侵害の瞬間は、こうです。

- IAMは通常通り使用される
- API呼び出しも正常
- HTTP 200 が返る
- レスポンス時間も問題なし

APM的には：**Everything is fine.**

しかしセキュリティ的には：

- 想定外のS3アクセス
- 大量データ取得
- 不審な外部通信

これはパフォーマンス問題ではありません。これは **"振る舞いの逸脱"** です。

> **APMは結果を見る。Runtime Securityは行動を見る。**

---

## ⑦ 攻撃は「遅く」ならない

ここが最大のポイントです。

攻撃の特徴：

- 正常API経由
- 正常IAM経由
- 正常レスポンス
- 正常メトリクス

攻撃は **"異常値" を出さない**。だからAPMでは守れない。

---

## ⑧ 可用性と防御は別問題

APMは本来、

- システムを止めない
- 遅くしない
- エラーを減らす

ためのものです。

しかし攻撃は、

- システムを止めない
- エラーを出さない
- むしろ正常に振る舞う

という性質を持ちます。**攻撃は"健全"を装います。**

だからAPMのダッシュボードは侵害中でも緑色になります。

---

## ⑨ Infrastructure → Identity → Runtime

クラウドネイティブで起きた本質的変化はこれです。

| 時代 | 侵害の流れ |
|------|-----------|
| 旧世界 | SSH侵入 → rootkit設置 → 永続化 → 横展開 |
| サーバレス | 入力悪用 → IAM濫用 → データ取得 → 外部送信 |

攻撃の重心が変わりました。しかし防御は、まだInfrastructure時代の発想に留まっています。

また、旧世界とサーバレスの対比で見ると：

| 旧世界 | サーバレス |
|--------|-----------|
| パッチ漏れ | 権限漏れ |
| SSH侵入 | API悪用 |
| rootkit | IAM悪用 |
| 永続化 | データ流出 |

攻撃は **OS → Identity + Event** へ移動しました。

---

## ⑩ Runtime-Firstという思想

### Runtime-Firstとは何か？

> **実行時の挙動を真実とする防御思想**

設定ではなく、設計思想でもなく、「実際に何が起きたか」を見る。

### 従来モデル vs Runtime-First

| 視点 | APM | Runtime-First |
|------|-----|---------------|
| 目的 | 可用性 | 防御 |
| 単位 | リクエスト | 振る舞い |
| 異常定義 | 遅い / エラー | 想定外 |
| タイミング | 事後分析 | 実行時 |

### Runtime-Firstが見るもの

- どのLambdaが呼ばれたか
- 誰が呼んだか
- どのIAM権限を"使用"したか
- どのリソースにアクセスしたか
- どこへ通信したか
- それは想定内か

ここまで見なければ、本当の意味での防御とは言えません。

---

## ⑪ 今のLambdaカバー範囲と足りないもの

現在、セキュリティツールがカバーしている範囲：

- **VM**（脆弱性スキャン）
- **Posture**（設定評価）

これは：

```
Build → Deploy → Config
```

を守っています。だが、まだ足りない。

最後に必要なのは：

```
Runtime
```

syscallレベルでの可視化こそが、Lambda防御の最後のピースです。

---

## ⑫ Lambdaは安全か？ ― 結論

**答えはこうです。**

> **部分的に安全。だが本質的には"不可視"。**

安全とは：

- 見えること
- 検知できること
- 止められること

Lambdaはインフラを消しました。しかし、**Runtimeは消えていない。**

---

## 最終結論

> **サーバレスはセキュリティを簡単にしたのではない。**
> **セキュリティの重心を移動させただけだ。**

そしてその重心は、今、**Runtimeにある**。

APMだけでは守れない。CNAPPだけでも不十分。

必要なのは、

### **Runtime-native Security**

です。
